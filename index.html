<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azulor Plataforma</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ... (all your existing styles unchanged) ... */
    /* Admin Login History Table */
    .admin-history-table {
      width: 100%;
      background: #fff;
      border-radius: 14px;
      box-shadow: var(--shadow);
      border-collapse: collapse;
      overflow: hidden;
      max-width: 720px;
      margin: 0 auto;
      margin-top: 2.5rem;
    }
    .admin-history-table th, .admin-history-table td {
      padding: 1.1em 0.8em;
      text-align: left;
      font-size: 1.08rem;
    }
    .admin-history-table th {
      background: var(--azulor-light, #f0f6fa);
      color: var(--azulor-main);
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .admin-history-table tr {
      border-bottom: 1px solid #f2f2f2;
    }
    .admin-history-table tr:last-child {
      border-bottom: none;
    }
    .admin-history-table td {
      font-size: 1.04rem;
      background: #fff;
    }
    .admin-history-header {
      text-align: center;
      font-size: 2.1rem;
      font-weight: 800;
      color: var(--azulor-main);
      margin-top: 2rem;
      margin-bottom: 0.7rem;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="loginBg" class="login-bg">
    <!-- LOGIN FORM -->
    <!-- ... (existing login and register forms unchanged) ... -->
  </div>
  <!-- RESTANTE DA APP -->
  <div class="main-wrapper" style="display:none" id="mainApp">
    <div class="sidebar">
      <div class="branding-logo">
        <img src="logo_azulor.png" alt="AZULOR logo">
      </div>
      <nav>
        <button class="nav-link active" id="nav-dashboard">Dashboard</button>
        <button class="nav-link" id="nav-pedidos">Pedidos</button>
        <button class="nav-link" id="nav-pagamentos">Pagamentos</button>
        <button class="nav-link" id="nav-entregas">Entregas</button>
        <button class="nav-link" id="nav-estoque">Stock</button>
        <button class="nav-link" id="nav-admin-history" style="display:none">Histórico de Logins</button>
        <button class="sidebar-logout" onclick="logout()">Sair</button>
      </nav>
    </div>
    <div class="main-content-area">
      <div class="topbar">
        <h1 class="topbar-title" id="topbar-title">Bem-vindo à Plataforma Azulor</h1>
      </div>
      <main id="main-content" class="main-content"></main>
    </div>
  </div>
  <footer>
    <div class="footer-inner">
      <img src="logo_azulor.png" alt="Logo Azulor">
      <span>© 2025 Azulor. Todos os direitos reservados.</span>
    </div>
  </footer>
  <!-- Pedido Modal -->
  <!-- ... (existing modals unchanged) ... -->
  <script>
    // --- USUÁRIOS REGISTRADOS (localStorage) ---
    // ... (existing user functions unchanged) ...

    // --- LOGIN HISTORY (localStorage) ---
    function getLoginHistory() {
      let h = [];
      try { h = JSON.parse(localStorage.getItem('azulor_login_history') || "[]"); } catch(e){}
      if (!Array.isArray(h)) h = [];
      return h;
    }
    function saveLoginHistory(history) {
      localStorage.setItem('azulor_login_history', JSON.stringify(history));
    }
    function addLoginHistory(username) {
      const users = getUsers();
      let email = '';
      if (username === 'admin') {
        email = 'admin@azulor.local';
      } else {
        const user = users.find(u => u.username === username);
        if (user) email = user.email;
      }
      const now = new Date();
      const entry = {
        username,
        email,
        datetime: now.toLocaleString('pt-PT', {year: 'numeric', month: '2-digit', day: '2-digit', 
          hour: '2-digit', minute: '2-digit', second: '2-digit'})
      };
      const history = getLoginHistory();
      history.unshift(entry); // newest first
      saveLoginHistory(history.slice(0, 100)); // limit to last 100 logins
    }

    // --- LOGIN/REGISTER UI ---
    // ... (existing login/register functions unchanged) ...

    // Track logged in user globally
    let currentLoggedUser = null;

    function showAppAfterLogin() {
      document.getElementById('loginBg').style.display = 'none';
      document.getElementById('mainApp').style.display = '';
      // Show admin-only menu if admin
      if (currentLoggedUser === 'admin') {
        document.getElementById('nav-admin-history').style.display = '';
      } else {
        document.getElementById('nav-admin-history').style.display = 'none';
      }
    }
    function logout() {
      sessionStorage.removeItem('azulor_loggedin');
      sessionStorage.removeItem('azulor_user');
      location.reload();
    }

    // On page load, check login/session
    if (sessionStorage.getItem('azulor_loggedin') === '1') {
      currentLoggedUser = sessionStorage.getItem('azulor_user') || null;
      document.getElementById('loginBg').style.display = 'none';
      document.getElementById('mainApp').style.display = '';
      if (currentLoggedUser === 'admin') {
        document.getElementById('nav-admin-history').style.display = '';
      }
    }

    document.getElementById('loginForm').onsubmit = function(e) {
      e.preventDefault();
      const user = document.getElementById('loginUser').value.trim();
      const pass = document.getElementById('loginPass').value;
      if (checkLogin(user, pass)) {
        sessionStorage.setItem('azulor_loggedin', '1');
        sessionStorage.setItem('azulor_user', user);
        currentLoggedUser = user;
        addLoginHistory(user);
        showAppAfterLogin();
      } else {
        document.getElementById('loginError').innerText = 'Usuário ou senha inválidos!';
        document.getElementById('loginError').style.display = '';
      }
    };
    document.getElementById('registerForm').onsubmit = function(e) {
      e.preventDefault();
      const user = document.getElementById('regUser').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pass = document.getElementById('regPass').value;
      document.getElementById('registerError').style.display = 'none';
      document.getElementById('registerSuccess').style.display = 'none';
      if (!user || !email || !pass) {
        document.getElementById('registerError').innerText = 'Preencha todos os campos!';
        document.getElementById('registerError').style.display = '';
        return;
      }
      const res = registerUser(user, email, pass);
      if (res === true) {
        document.getElementById('registerSuccess').innerText = 'Usuário registrado com sucesso! Você pode fazer login.';
        document.getElementById('registerSuccess').style.display = '';
        setTimeout(showLoginForm, 1300);
      } else {
        document.getElementById('registerError').innerText = res;
        document.getElementById('registerError').style.display = '';
      }
    };

    // --- RESTANTE DA APP ---
    // ... (existing db and render logic unchanged) ...

    let currentPage = 'dashboard';
    function showCurrentPage() {
      switch(currentPage) {
        case 'dashboard': renderDashboard(); break;
        case 'pedidos': renderPedidos(); break;
        case 'pagamentos': renderPagamentos(); break;
        case 'entregas': renderEntregas(); break;
        case 'estoque': renderEstoque(); break;
        case 'admin-history': renderAdminHistory(); break;
      }
    }

    // Add admin history rendering
    function renderAdminHistory() {
      setTitle('Histórico de Logins');
      const history = getLoginHistory();
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div class="admin-history-header">Histórico de Logins dos Usuários</div>
        <table class="admin-history-table">
          <thead>
            <tr>
              <th>Usuário</th>
              <th>Email</th>
              <th>Data e Hora</th>
            </tr>
          </thead>
          <tbody>
            ${history.length === 0 
              ? `<tr><td colspan="3" style="text-align:center;color:#888;padding:2em;">Nenhum login registrado.</td></tr>`
              : history.map(h => `
                <tr>
                  <td>${h.username}</td>
                  <td>${h.email || ''}</td>
                  <td>${h.datetime}</td>
                </tr>
              `).join('')}
          </tbody>
        </table>
      `;
    }

    // Update nav event listeners to support admin history
    document.getElementById('nav-dashboard').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-dashboard');
      currentPage = 'dashboard';
      renderDashboard();
    };
    document.getElementById('nav-pedidos').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-pedidos');
      currentPage = 'pedidos';
      renderPedidos();
    };
    document.getElementById('nav-pagamentos').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-pagamentos');
      currentPage = 'pagamentos';
      renderPagamentos();
    };
    document.getElementById('nav-entregas').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-entregas');
      currentPage = 'entregas';
      renderEntregas();
    };
    document.getElementById('nav-estoque').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-estoque');
      currentPage = 'estoque';
      renderEstoque();
    };
    document.getElementById('nav-admin-history').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-admin-history');
      currentPage = 'admin-history';
      renderAdminHistory();
    };

    function setActiveNav(id) {
      document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    function setTitle(text) {
      document.getElementById('topbar-title').textContent = text;
    }

    // ... (rest of your code unchanged) ...
    renderDashboard();
  </script>
</body>
</html>
