<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Business Management Platform</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --danger: #dc2626;
            --green: #10b981;
            --gray: #f3f4f6;
            --radius: 8px;
            --shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--gray);
        }
        .container {
            max-width: 1024px;
            margin: 32px auto;
            background: #fff;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 32px 24px;
        }
        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-bar h1 {
            font-size: 1.7em;
            font-weight: 700;
            margin: 0;
        }
        nav {
            display: flex;
            gap: 12px;
            margin: 28px 0 18px 0;
        }
        nav button {
            background: none;
            border: none;
            font-size: 1em;
            padding: 8px 18px;
            border-radius: var(--radius);
            cursor: pointer;
            color: #333;
            transition: background 0.2s;
        }
        nav button.active, nav button:hover {
            background: var(--primary);
            color: #fff;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .panel {
            background: var(--gray);
            border-radius: var(--radius);
            margin-bottom: 30px;
            padding: 18px 20px 8px 20px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }
        .panel h2 {
            margin-top: 0;
            font-size: 1.2em;
            font-weight: 600;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
        }
        th, td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .actions button {
            margin-right: 5px;
            padding: 4px 10px;
            border-radius: 4px;
            border: none;
            font-size: 0.95em;
            cursor: pointer;
        }
        .actions .edit {
            background: var(--primary-light);
            color: #fff;
        }
        .actions .delete {
            background: var(--danger);
            color: #fff;
        }
        .actions .addcart {
            background: var(--green);
            color: #fff;
        }
        .floating-btn, #cart-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 100px;
            font-size: 1.3em;
            width: 40px; height: 40px;
            position: absolute;
            right: 24px; top: 18px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(37,99,235,0.18);
        }
        #cart-btn {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 56px; height: 56px;
            font-size: 1.7em;
            z-index: 100;
            display: none;
        }
        .modal-bg {
            background: rgba(0,0,0,0.18);
            position: fixed;
            inset: 0;
            display: none;
            z-index: 50;
        }
        .modal-bg.active { display: flex; align-items: center; justify-content: center; }
        .modal {
            background: #fff;
            padding: 32px 26px 20px 26px;
            border-radius: var(--radius);
            min-width: 320px;
            min-height: 120px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 14px;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 10px; right: 10px;
            background: none;
            border: none;
            font-size: 1.3em;
            color: #aaa;
            cursor: pointer;
        }
        .modal label {
            display: block;
            margin-bottom: 8px;
        }
        .modal input, .modal select {
            width: 100%;
            font-size: 1em;
            padding: 8px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .modal-actions {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .modal-actions button {
            font-size: 1em;
            padding: 7px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .modal-actions .save { background: var(--primary); color: #fff;}
        .modal-actions .cancel { background: #e5e7eb; color: #333;}
        .notification {
            position: fixed;
            right: 24px;
            top: 24px;
            background: var(--primary);
            color: #fff;
            padding: 15px 28px;
            border-radius: 7px;
            font-size: 1.1em;
            z-index: 200;
            box-shadow: var(--shadow);
            opacity: 0.97;
            display: none;
        }
        .notification.error { background: var(--danger);}
        /* Auth overlay */
        #login-overlay {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #f3f4f680;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #login-card {
            background: #fff;
            box-shadow: var(--shadow);
            border-radius: var(--radius);
            padding: 32px 40px 28px 40px;
            min-width: 340px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        #login-card h2 { margin: 0 0 10px 0; }
        #login-card input {
            padding: 9px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 16px;
        }
        #login-card button {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            padding: 10px 0;
            cursor: pointer;
        }
        #login-card .error {
            color: var(--danger);
            margin-bottom: 8px;
            font-size: 0.98em;
        }
        @media (max-width: 700px) {
            .container { padding: 10px 3vw;}
            .modal { min-width: 90vw; }
            #cart-btn { right: 12px; bottom: 12px;}
        }
    </style>
</head>
<body>
<div class="container" id="app" style="display:none;">
    <div class="header-bar">
        <h1>Business Management Platform</h1>
        <button class="actions delete" id="logoutBtn" onclick="logout()" style="font-size:1em;">Logout</button>
    </div>
    <nav>
        <button class="tablink active" onclick="showTab('articles')">Articles</button>
        <button class="tablink" onclick="showTab('stock')">Stock</button>
        <button class="tablink" onclick="showTab('delivery')">Delivery</button>
    </nav>
    <!-- ARTICLES -->
    <section class="section active" id="articles-section">
        <div class="panel" style="position:relative;">
            <h2>Articles</h2>
            <button class="floating-btn" onclick="openModal('article')">+</button>
            <table>
                <thead>
                    <tr>
                        <th>SKU</th><th>Name</th><th>Description</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody id="articles-list"></tbody>
            </table>
        </div>
    </section>
    <!-- STOCK -->
    <section class="section" id="stock-section">
        <div class="panel" style="position:relative;">
            <h2>Stock</h2>
            <button class="floating-btn" onclick="openModal('stock')">+</button>
            <table>
                <thead>
                    <tr>
                        <th>SKU</th><th>Name</th><th>Quantity</th><th>Actions</th>
                    </tr>
                </thead>
                <tbody id="stock-list"></tbody>
            </table>
        </div>
    </section>
    <!-- DELIVERIES -->
    <section class="section" id="delivery-section">
        <div class="panel" style="position:relative;">
            <h2>Delivery</h2>
            <button class="floating-btn" onclick="openModal('delivery')">+</button>
            <table>
                <thead>
                    <tr>
                        <th>SKU</th><th>Name</th><th>Qty</th><th>Destination</th><th>Date</th>
                    </tr>
                </thead>
                <tbody id="delivery-list"></tbody>
            </table>
        </div>
    </section>
</div>
<!-- LOGIN OVERLAY -->
<div id="login-overlay">
    <form id="login-card" onsubmit="return login(event)">
        <h2>Sign In</h2>
        <input type="text" id="login-username" placeholder="Username" autocomplete="username" required>
        <input type="password" id="login-password" placeholder="Password" autocomplete="current-password" required>
        <div id="login-error" class="error"></div>
        <button type="submit">Login</button>
    </form>
</div>
<!-- CART FLOATING BUTTON -->
<button id="cart-btn" onclick="showCartModal()">üõí</button>
<!-- CART MODAL -->
<div class="modal-bg" id="cart-modal-bg">
  <div class="modal" style="min-width:350px">
    <button type="button" class="modal-close" onclick="closeCartModal()">&times;</button>
    <div style="font-weight:600; font-size:1.1em; margin-bottom:10px;">Cesto de Compras</div>
    <div id="cart-list"></div>
    <div style="text-align:right; margin-top:16px;">
      <button class="cancel" onclick="closeCartModal()">Fechar</button>
      <button class="save" onclick="clearCart()" style="margin-left:8px;">Esvaziar Cesto</button>
    </div>
  </div>
</div>
<!-- MODALS -->
<div class="modal-bg" id="modal-bg">
    <form class="modal" id="modal-form" onsubmit="return modalSave(event)">
        <button type="button" class="modal-close" onclick="closeModal()">&times;</button>
        <div id="modal-title" style="font-weight:600;font-size:1.1em;"></div>
        <div id="modal-body"></div>
        <div class="modal-actions">
            <button type="button" class="cancel" onclick="closeModal()">Cancel</button>
            <button type="submit" class="save">Save</button>
        </div>
    </form>
</div>
<!-- NOTIFICATION -->
<div class="notification" id="notification"></div>
<script>
/** --- LOCALSTORAGE KEY CONSTANTS --- **/
const LS_USER = 'bmp_user';
const LS_ARTICLES = 'bmp_articles';
const LS_STOCK = 'bmp_stock';
const LS_DELIVERY = 'bmp_delivery';
const LS_CART = "bmp_cart";

/** --- CREDENTIALS (SET YOUR OWN) --- **/
const VALID_USER = "admin";
const VALID_PASS = "admin"; // Change for production!

/** --- USER AUTHENTICATION --- **/
function showApp(logged) {
    document.getElementById('login-overlay').style.display = logged ? 'none' : 'flex';
    document.getElementById('app').style.display = logged ? '' : 'none';
}
function checkAuth() {
    if (localStorage.getItem(LS_USER)) showApp(true);
    else showApp(false);
}
function login(e) {
    e.preventDefault();
    let user = document.getElementById('login-username').value;
    let pass = document.getElementById('login-password').value;
    if (user === VALID_USER && pass === VALID_PASS) {
        localStorage.setItem(LS_USER, user);
        showNotification("Logged in!", false);
        showApp(true);
        setTimeout(()=>{renderAll();},100);
    } else {
        document.getElementById('login-error').textContent = "Invalid credentials";
        return false;
    }
    return false;
}
function logout() {
    if (confirm("Logout?")) {
        localStorage.removeItem(LS_USER);
        location.reload();
    }
}

/** --- UTILS --- **/
function getData(key) { return JSON.parse(localStorage.getItem(key)||'[]'); }
function setData(key, arr) { localStorage.setItem(key, JSON.stringify(arr)); }
function showNotification(msg, isError) {
    let n = document.getElementById('notification');
    n.textContent = msg;
    n.className = "notification"+(isError?" error":"");
    n.style.display = "block";
    setTimeout(()=>{ n.style.display = "none"; }, 1900);
}

/** --- TABS --- **/
function showTab(tab) {
    Array.from(document.querySelectorAll('.section')).forEach(el=>el.classList.remove('active'));
    document.getElementById(tab+'-section').classList.add('active');
    Array.from(document.querySelectorAll('.tablink')).forEach(el=>el.classList.remove('active'));
    let idx = ['articles','stock','delivery'].indexOf(tab);
    document.querySelectorAll('.tablink')[idx].classList.add('active');
}

/** --- MODAL LOGIC --- **/
let modalContext = {};
function openModal(type, editObj) {
    modalContext = {type, editObj};
    let title = '', body = '';
    if (type==='article') {
        title = (editObj?'Edit':'Add')+' Article';
        let name = editObj?.name||'', desc = editObj?.desc||'', sku = editObj?.sku||'';
        body = `
          <label>Name: <input type="text" id="modal-article-name" value="${name}" required></label>
          <label>Description: <input type="text" id="modal-article-desc" value="${desc}" required></label>
          <label>SKU: <input type="text" id="modal-article-sku" value="${sku}" ${editObj?'readonly disabled':''} required></label>
        `;
    }
    if (type==='stock') {
        title = (editObj?'Edit':'Add')+' Stock';
        let articles = getData(LS_ARTICLES);
        let options = `<option value="">Select...</option>`;
        for(let art of articles) options += `<option value="${art.sku}">${art.sku} - ${art.name}</option>`;
        let sku = editObj?.sku||'', qty = editObj?.qty||'';
        body = `
          <label>Article SKU: 
            <select id="modal-stock-sku" required ${editObj?'disabled':''}>${options}</select>
          </label>
          <label>Quantity: <input type="number" id="modal-stock-qty" min="1" value="${qty}" required></label>
        `;
        setTimeout(()=>{if(editObj)document.getElementById('modal-stock-sku').value=sku;},10);
    }
    if (type==='delivery') {
        title = (editObj?'Edit':'New')+' Delivery';
        let articles = getData(LS_ARTICLES), stock = getData(LS_STOCK);
        let options = `<option value="">Select...</option>`;
        for(let art of articles) {
            let s = stock.find(st=>st.sku===art.sku);
            if (s && s.qty>0) options += `<option value="${art.sku}">${art.sku} - ${art.name} (Available: ${s.qty})</option>`;
        }
        let sku = editObj?.sku||'', qty=editObj?.qty||'', dest=editObj?.dest||'';
        body = `
          <label>Article SKU: 
            <select id="modal-delivery-sku" required>${options}</select>
          </label>
          <label>Quantity: <input type="number" id="modal-delivery-qty" min="1" value="${qty}" required></label>
          <label>Destination: <input type="text" id="modal-delivery-dest" value="${dest}" required></label>
        `;
        setTimeout(()=>{if(editObj)document.getElementById('modal-delivery-sku').value=sku;},10);
    }
    document.getElementById('modal-title').innerHTML = title;
    document.getElementById('modal-body').innerHTML = body;
    document.getElementById('modal-bg').classList.add('active');
}
function closeModal() {
    document.getElementById('modal-bg').classList.remove('active');
    modalContext = {};
}
function modalSave(e) {
    e.preventDefault();
    let {type, editObj} = modalContext;
    if (type==='article') {
        let name = document.getElementById('modal-article-name').value.trim();
        let desc = document.getElementById('modal-article-desc').value.trim();
        let sku = document.getElementById('modal-article-sku').value.trim();
        if (!name || !desc || !sku) { showNotification("All fields required", true); return false; }
        let articles = getData(LS_ARTICLES);
        if (!editObj && articles.some(a=>a.sku===sku)) { showNotification("SKU already exists!", true); return false; }
        if (editObj) {
            let idx = articles.findIndex(a=>a.sku===sku);
            articles[idx].name = name; articles[idx].desc = desc;
        } else {
            articles.push({name, desc, sku});
        }
        setData(LS_ARTICLES, articles);
        showNotification(editObj?"Article updated":"Article added");
        renderArticles();
        closeModal();
        return false;
    }
    if (type==='stock') {
        let sku = document.getElementById('modal-stock-sku').value;
        let qty = parseInt(document.getElementById('modal-stock-qty').value,10);
        if (!sku || !qty) { showNotification("All fields required", true); return false; }
        let stock = getData(LS_STOCK);
        let s = stock.find(st=>st.sku===sku);
        if (editObj) {
            s.qty = qty;
        } else {
            if (s) s.qty += qty;
            else stock.push({sku, qty});
        }
        setData(LS_STOCK, stock);
        showNotification(editObj?"Stock updated":"Stock added");
        renderStock();
        closeModal();
        return false;
    }
    if (type==='delivery') {
        let sku = document.getElementById('modal-delivery-sku').value;
        let qty = parseInt(document.getElementById('modal-delivery-qty').value,10);
        let dest = document.getElementById('modal-delivery-dest').value.trim();
        if (!sku || !qty || !dest) { showNotification("All fields required", true); return false; }
        let stock = getData(LS_STOCK);
        let s = stock.find(st=>st.sku===sku);
        if (!s || s.qty<qty) { showNotification("Not enough stock!", true); return false; }
        s.qty -= qty;
        setData(LS_STOCK, stock);
        let deliveries = getData(LS_DELIVERY);
        deliveries.push({sku, qty, dest, date: (new Date().toLocaleString())});
        setData(LS_DELIVERY, deliveries);
        showNotification("Delivery registered");
        renderStock();
        renderDelivery();
        closeModal();
        return false;
    }
    return false;
}

/** --- CART LOGIC --- */
function getCart() { return JSON.parse(localStorage.getItem(LS_CART) || "[]"); }
function setCart(arr) { localStorage.setItem(LS_CART, JSON.stringify(arr)); }
function addToCart(sku) {
    let cart = getCart();
    let idx = cart.findIndex(item => item.sku === sku);
    if(idx >= 0) { cart[idx].qty++; }
    else cart.push({sku, qty: 1});
    setCart(cart);
    showNotification("Adicionado ao cesto!");
    updateCartBtn();
}
function removeFromCart(sku) {
    let cart = getCart();
    cart = cart.filter(item => item.sku !== sku);
    setCart(cart);
    showCartModal();
    updateCartBtn();
}
function clearCart() {
    if(confirm("Esvaziar o cesto?")) {
        setCart([]);
        showCartModal();
        updateCartBtn();
    }
}
function updateCartBtn() {
    let cart = getCart();
    let btn = document.getElementById("cart-btn");
    let total = cart.reduce((a, b) => a + b.qty, 0);
    btn.style.display = total > 0 ? "block" : "none";
    btn.innerHTML = "üõí" + (total > 0 ? `<span style='font-size:0.7em'>${total}</span>` : "");
}
function showCartModal() {
    let cart = getCart();
    let articles = getData(LS_ARTICLES);
    let html = "";
    if(cart.length === 0) html = "<i>O cesto est√° vazio.</i>";
    else html = `<table style="width:100%;font-size:1em;">
        <tr><th>SKU</th><th>Nome</th><th>Qtd</th><th>A√ß√£o</th></tr>` +
        cart.map(item => {
            let art = articles.find(a => a.sku === item.sku);
            return `<tr>
                <td>${item.sku}</td>
                <td>${art ? art.name : "[Removido]"}</td>
                <td>${item.qty}</td>
                <td><button class="delete" onclick="removeFromCart('${item.sku}')">Remover</button></td>
            </tr>`;
        }).join("") + "</table>";
    document.getElementById("cart-list").innerHTML = html;
    document.getElementById("cart-modal-bg").classList.add("active");
}
function closeCartModal() {
    document.getElementById("cart-modal-bg").classList.remove("active");
}

/** --- RENDERING UI --- **/
function renderArticles() {
    let articles = getData(LS_ARTICLES);
    let tbody = '';
    for(let art of articles) {
        tbody += `<tr>
            <td>${art.sku}</td>
            <td>${art.name}</td>
            <td>${art.desc}</td>
            <td class="actions">
                <button class="edit" onclick="openModal('article',${JSON.stringify(art)})">Edit</button>
                <button class="delete" onclick="deleteArticle('${art.sku}')">Delete</button>
                <button class="addcart" onclick="addToCart('${art.sku}')">Adicionar ao cesto</button>
            </td>
        </tr>`;
    }
    document.getElementById('articles-list').innerHTML = tbody;
    updateCartBtn();
}
function renderStock() {
    let stock = getData(LS_STOCK);
    let articles = getData(LS_ARTICLES);
    let tbody = '';
    for(let st of stock) {
        let art = articles.find(a=>a.sku===st.sku);
        tbody += `<tr>
            <td>${st.sku}</td>
            <td>${art?.name||"[Deleted]"}</td>
            <td>${st.qty}</td>
            <td class="actions">
                <button class="edit" onclick="openModal('stock',${JSON.stringify(st)})">Edit</button>
                <button class="delete" onclick="deleteStock('${st.sku}')">Delete</button>
            </td>
        </tr>`;
    }
    document.getElementById('stock-list').innerHTML = tbody;
}
function renderDelivery() {
    let deliveries = getData(LS_DELIVERY);
    let articles = getData(LS_ARTICLES);
    let tbody = '';
    for(let d of deliveries) {
        let art = articles.find(a=>a.sku===d.sku);
        tbody += `<tr>
            <td>${d.sku}</td>
            <td>${art?.name||"[Deleted]"}</td>
            <td>${d.qty}</td>
            <td>${d.dest}</td>
            <td>${d.date}</td>
        </tr>`;
    }
    document.getElementById('delivery-list').innerHTML = tbody;
}
function renderAll() {
    renderArticles();
    renderStock();
    renderDelivery();
}

/** --- REMOVE/DELETE LOGIC --- **/
function deleteArticle(sku) {
    if (!confirm("Delete this article? This may affect stock and deliveries.")) return;
    let articles = getData(LS_ARTICLES).filter(a=>a.sku!==sku);
    let stock = getData(LS_STOCK).filter(st=>st.sku!==sku);
    setData(LS_ARTICLES, articles);
    setData(LS_STOCK, stock);
    // Do not delete delivery history, but show as [Deleted]
    showNotification("Article deleted");
    renderArticles(); renderStock(); renderDelivery();
}
function deleteStock(sku) {
    if (!confirm("Remove stock for this article?")) return;
    let stock = getData(LS_STOCK).filter(s=>s.sku!==sku);
    setData(LS_STOCK, stock);
    showNotification("Stock removed");
    renderStock();
}

/** --- BOOTSTRAP --- **/
window.onload = function() {
    checkAuth();
    if (localStorage.getItem(LS_USER)) renderAll();
    updateCartBtn();
    // preload demo articles only if none exist
    if(!localStorage.getItem(LS_ARTICLES)) {
        setData(LS_ARTICLES, [
            {sku:"001",name:"L√¢mpada LED 10W",desc:"L√¢mpada LED de alta efici√™ncia energ√©tica, ideal para iluminar ambientes."},
            {sku:"002",name:"Cadeira Gamer Ergonomica",desc:"Cadeira confort√°vel e ajust√°vel, perfeita para longas sess√µes de gaming."},
            {sku:"003",name:"Teclado Mec√¢nico RGB",desc:"Teclado mec√¢nico com retroilumina√ß√£o RGB, ideal para gamers."},
            {sku:"004",name:"C√¢mera de Seguran√ßa 1080p",desc:"C√¢mera de seguran√ßa Full HD com vis√£o noturna, perfeita para seguran√ßa."},
            {sku:"005",name:"Fone de Ouvido Bluetooth",desc:"Fones de ouvido sem fio, com cancelamento de ru√≠do e alta qualidade de som."},
            {sku:"006",name:"Smartphone 64GB",desc:"Smartphone de 64GB, com tela de 6.5\" e c√¢meras de alta resolu√ß√£o."},
            {sku:"007",name:"Mochila de Viagem 30L",desc:"Mochila resistente √† √°gua, com compartimentos ajust√°veis e de f√°cil acesso."},
            {sku:"008",name:"M√°scara de Exerc√≠cio",desc:"M√°scara para atividades f√≠sicas, ajuda na resist√™ncia e performance."},
            {sku:"009",name:"Suporte para Teclado",desc:"Suporte ajust√°vel para teclado, perfeito para melhorar a postura."},
            {sku:"010",name:"Extens√£o El√©trica 3M",desc:"Extens√£o el√©trica de 3 metros, com 4 tomadas para diversos aparelhos."}
        ]);
        renderArticles();
    }
};
</script>
</body>
</html>
