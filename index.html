<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azulor Plataforma</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ... (css unchanged, same as previous version) ... */
  </style>
</head>
<body>
  <div class="main-wrapper">
    <div class="sidebar">
      <div class="branding-logo">
        <img src="logo_azulor.png" alt="AZULOR logo">
      </div>
      <nav>
        <button class="nav-link active" id="nav-dashboard">Dashboard</button>
        <button class="nav-link" id="nav-clientes">Clientes</button>
        <button class="nav-link" id="nav-pedidos">Pedidos</button>
        <button class="nav-link" id="nav-pagamentos">Pagamentos</button>
      </nav>
    </div>
    <div class="main-content-area">
      <div class="topbar">
        <h1 class="topbar-title" id="topbar-title">Bem-vindo à Plataforma Azulor</h1>
      </div>
      <main id="main-content" class="main-content"></main>
    </div>
  </div>
  <footer>
    <div class="footer-inner">
      <img src="logo_azulor.png" alt="Logo Azulor">
      <span>© 2025 Azulor. Todos os direitos reservados.</span>
    </div>
  </footer>
  <!-- Modal Adicionar Cliente -->
  <div id="clienteModalBg" class="modal-bg">
    <div class="modal">
      <button onclick="closeClienteModal()" class="close-btn">&times;</button>
      <h2>Novo Cliente</h2>
      <form id="clienteForm" autocomplete="off">
        <label>Nome</label>
        <input name="nome" required maxlength="50">
        <label>Email</label>
        <input name="email" type="email" required maxlength="60">
        <label>Telefone</label>
        <input name="telefone" required maxlength="20">
        <label>Pedido / Detalhes</label>
        <textarea name="detalhes" required placeholder="Descreva o que o cliente solicita"></textarea>
        <button type="submit">Adicionar Cliente</button>
      </form>
    </div>
  </div>
  <!-- Pedido Modal -->
  <div id="pedidoModalBg" class="modal-bg">
    <div class="modal">
      <button onclick="closePedidoModal()" class="close-btn">&times;</button>
      <h2>Novo Pedido</h2>
      <form id="pedidoForm" autocomplete="off">
        <label>Cliente</label>
        <input name="cliente" required maxlength="50">
        <label>Data</label>
        <input name="data" type="date" required>
        <label>Valor (€)</label>
        <input name="valor" type="number" min="0" step="0.01" required>
        <label>Status</label>
        <select name="status">
          <option value="Pendente">Pendente</option>
          <option value="Pago">Pago</option>
        </select>
        <button type="submit">Adicionar Pedido</button>
      </form>
    </div>
  </div>
  <script>
    // Persistent DB: load from localStorage or start empty
    let db = {
      clientes: [],
      pedidos: [],
      pagamentos: []
    };
    const dbSaved = localStorage.getItem('azulor_db');
    if (dbSaved) {
      db = JSON.parse(dbSaved);
    }
    function saveDB() {
      localStorage.setItem('azulor_db', JSON.stringify(db));
    }

    // Navigation state
    function setActiveNav(id) {
      document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    function setTitle(text) {
      document.getElementById('topbar-title').textContent = text;
    }

    // Dashboard
    function renderDashboard() {
      setTitle('Bem-vindo à Plataforma Azulor');
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div class="dashboard-row">
          <div class="dashboard-card">
            <div class="card-label">Clientes</div>
            <div class="card-value">${db.clientes.filter(c => !c.concluido).length}</div>
          </div>
          <div class="dashboard-card">
            <div class="card-label">Pedidos</div>
            <div class="card-value">${db.pedidos.length}</div>
          </div>
          <div class="dashboard-card">
            <div class="card-label">Pagamentos</div>
            <div class="card-value">${db.pagamentos.length}</div>
          </div>
        </div>
        <div class="dashboard-info">
          Selecione uma opção no menu à esquerda para começar.
        </div>
      `;
    }

    // Clientes
    function renderClientes() {
      setTitle('Clientes');
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div style="display:flex;justify-content:flex-end;margin-bottom:18px;">
          <button id="btnNovoCliente" style="background: #04243d;color: #fff;padding: 0.67em 1.5em;font-size: 1rem;font-weight: 600;border: none;border-radius: 7px;box-shadow: 0 1px 8px rgba(4,36,61,0.06);cursor: pointer;">
            + Novo Cliente
          </button>
        </div>
        <div class="az-table-wrap">
          <table class="az-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Pedido/Detalhes</th>
                <th>Conclusão</th>
              </tr>
            </thead>
            <tbody>
              ${db.clientes.filter(c => !c.concluido).map(c => `
                <tr>
                  <td>${c.id}</td>
                  <td>${c.nome}</td>
                  <td>${c.email}</td>
                  <td>${c.telefone}</td>
                  <td>${c.detalhes ? c.detalhes.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ''}</td>
                  <td>
                    <button class="conclusion-btn" data-client-id="${c.id}">Concluir</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;

      // Add event listeners for all "Concluir" buttons
      document.querySelectorAll('.conclusion-btn').forEach(btn => {
        btn.onclick = function() {
          const clientId = parseInt(this.getAttribute('data-client-id'), 10);
          concluirCliente(clientId);
        }
      });

      // Novo Cliente
      document.getElementById('btnNovoCliente').onclick = openClienteModal;
    }

    function concluirCliente(clientId) {
      // Mark client as concluded
      const idx = db.clientes.findIndex(c => c.id === clientId);
      if (idx !== -1) {
        db.clientes[idx].concluido = true;
        saveDB();
        renderConclusao(db.clientes[idx]);
      }
    }

    function renderConclusao(cliente) {
      setTitle('Concluído');
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div class="conclusion-page">
          <h2>Solicitação Concluída!</h2>
          <div class="conclusion-info">
            O pedido do cliente <b>${cliente.nome}</b> foi concluído com sucesso.<br>
            <div style="margin-top:1.2em;font-size:1.05em;color:#222;">
              <b>Detalhes:</b> ${cliente.detalhes ? cliente.detalhes.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ''}
            </div>
          </div>
          <button class="conclusion-back" id="conclusionBackBtn">Voltar para Clientes</button>
        </div>
      `;
      document.getElementById('conclusionBackBtn').onclick = () => {
        renderClientes();
        setActiveNav('nav-clientes');
      };
    }

    // Modal Add Cliente
    function openClienteModal() {
      document.getElementById('clienteModalBg').style.display = 'flex';
      document.getElementById('clienteForm').reset();
    }
    function closeClienteModal() {
      document.getElementById('clienteModalBg').style.display = 'none';
    }
    document.getElementById('clienteForm').onsubmit = function(e) {
      e.preventDefault();
      const form = e.target;
      const novoCliente = {
        id: (db.clientes.at(-1)?.id || 0) + 1,
        nome: form.nome.value,
        email: form.email.value,
        telefone: form.telefone.value,
        detalhes: form.detalhes.value,
        concluido: false
      };
      db.clientes.push(novoCliente);
      saveDB();

      // Adiciona automaticamente esse cliente em Pedidos
      db.pedidos.push({
        id: (db.pedidos.at(-1)?.id || 100) + 1,
        cliente: novoCliente.nome,
        data: new Date().toISOString().slice(0, 10),
        valor: 0,
        status: "Pendente"
      });
      saveDB();

      closeClienteModal();
      renderClientes();
      setActiveNav('nav-clientes');
    };

    // Pedidos
    function renderPedidos() {
      setTitle('Pedidos');
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div class="az-table-wrap" style="margin-top:0;">
          <div style="display:flex;justify-content:flex-end;margin-bottom:18px;">
            <button id="btnNovoPedido" style="background: #04243d;color: #fff;padding: 0.67em 1.5em;font-size: 1rem;font-weight: 600;border: none;border-radius: 7px;box-shadow: 0 1px 8px rgba(4,36,61,0.06);cursor: pointer;">
              + Novo Pedido
            </button>
          </div>
          <table class="az-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Data</th>
                <th>Valor (€)</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="pedidosTableBody"></tbody>
          </table>
        </div>
      `;
      document.getElementById('btnNovoPedido').onclick = openPedidoModal;
      renderPedidosTable();
    }
    function renderPedidosTable() {
      document.getElementById('pedidosTableBody').innerHTML = db.pedidos.length === 0
        ? `<tr><td colspan="5" style="text-align:center;color:#888;padding:2em;">Nenhum pedido cadastrado.</td></tr>`
        : db.pedidos.map(p => `
            <tr>
              <td style="text-align:center;">${p.id}</td>
              <td>${p.cliente}</td>
              <td>${p.data}</td>
              <td style="text-align:right;">${Number(p.valor).toFixed(2)}</td>
              <td>
                <span class="badge ${p.status==='Pago'?'pago':'pendente'}">
                  ${p.status}
                </span>
              </td>
            </tr>
          `).join('');
    }

    // Pagamentos
    function renderPagamentos() {
      setTitle('Pagamentos');
      const main = document.getElementById('main-content');
      main.innerHTML = `
        <div class="az-table-wrap">
          <table class="az-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Valor (€)</th>
                <th>Data</th>
                <th>Método</th>
              </tr>
            </thead>
            <tbody>
              ${db.pagamentos.map(pg => `
                <tr>
                  <td>${pg.id}</td>
                  <td>${pg.cliente}</td>
                  <td style="text-align:right;">${pg.valor.toFixed(2)}</td>
                  <td>${pg.data}</td>
                  <td>${pg.metodo}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // Pedido Modal
    function openPedidoModal() {
      document.getElementById('pedidoModalBg').style.display = 'flex';
      document.getElementById('pedidoForm').reset();
    }
    function closePedidoModal() {
      document.getElementById('pedidoModalBg').style.display = 'none';
    }
    document.getElementById('pedidoForm').onsubmit = function(e) {
      e.preventDefault();
      const form = e.target;
      db.pedidos.push({
        id: (db.pedidos.at(-1)?.id || 100) + 1,
        cliente: form.cliente.value,
        data: form.data.value,
        valor: Number(form.valor.value),
        status: form.status.value
      });
      saveDB();
      closePedidoModal();
      renderPedidosTable();
    };

    // Navigation events
    document.getElementById('nav-dashboard').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-dashboard');
      renderDashboard();
    };
    document.getElementById('nav-clientes').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-clientes');
      renderClientes();
    };
    document.getElementById('nav-pedidos').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-pedidos');
      renderPedidos();
    };
    document.getElementById('nav-pagamentos').onclick = (e)=>{
      e.preventDefault();
      setActiveNav('nav-pagamentos');
      renderPagamentos();
    };

    // Initial page
    renderDashboard();
  </script>
</body>
</html>
